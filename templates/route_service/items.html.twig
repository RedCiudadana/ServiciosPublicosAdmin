{% extends '_main.html.twig' %}

{% import "_table.html.twig" as table %}
{% import "_buttons.html.twig" as buttons %}

{% block title %}{% trans %}Rutas de servicios{% endtrans %}{% endblock %}

{% block body %}
    <div class="col-lg-12">
        <h1 class="font-sans px-8 py-4 rounded mt-0 mb-4 bg-white shadow-sm text-xl font-bold">{% trans %}Agregar servicio{% endtrans %}</h1>
    </div>
    <div class="col-lg-12">
        <div class="px-8 py-4 rounded mt-0 mb-4 bg-white shadow-sm text-xl font-bold">
            {{ form_start(form) }}
                {{ form_widget(form) }}
                <button class="bg-blue-700 text-white px-3 py-2 rounded font-bold text-xs mb-4">{{ button_label|default('Agregar servicio') }}</button>
            {{ form_end(form) }}
        </div>
    </div>

    <div class="col-lg-12 relative z-0">
        <h1 class="font-sans px-8 py-4 rounded mt-0 mb-4 bg-white shadow-sm text-xl font-bold relative">
            {% trans %}Servicios de rutas{% endtrans %}
        </h1>
    </div>

    <div class="col-lg-12 relative">
        <div class="table-responsive bg-white relative">
            {# <table class="table table-head-custom table-head-bg table-borderless table-vertical-center relative">
                <thead class="bg-slate-50">
                    <tr>
                        {{ table.th("Id"|trans) }}
                        {{ table.th("Name"|trans) }}
                        {{ table.th("actions"|trans) }}
                    </tr>
                </thead>
                <tbody>
                    {% for item in route_service.routeServiceItems %}
                    <tr>
                        {{ table.td(item.id) }}
                        {{ table.td(item.publicService.name) }}
            
                        {% set actions %}
                            <form action="{{ path('app_route_service_items_delete', {'id': route_service.id, routeServiceItem: item.id }) }}"
                                method="post">
                                <button type="submit" class="underline pr-2 text-red-600">{% trans %}delete{% endtrans %}</a>
                            </form>
                            <a href="{{ path('app_route_service_items_public_service', {'id': route_service.id, publicService: item.publicService.id }) }}">
                                Agregar dependencia
                            </a>
                        {% endset %}

                        {{ table.td(actions, "w-48") }}
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3">{% trans %}Está ruta no tiene ningún tramite asignado{% endtrans %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table> #}

            {% macro menu_nodes(nodes, publicServicesHash, level, route_service, parent) %}
                {% import _self as macros %}

                {% for node in nodes %}
                    <div style="padding-left: {{level + 1}}rem;">
                        {{ publicServicesHash[node.properties.identifier].name }}
                        <a href="{{
                                path('app_route_service_items_public_service',
                                {'id': route_service.id, publicService: publicServicesHash[node.properties.identifier].id })
                            }}"
                            class="ml-10"
                        >
                            Agregar dependencia
                        </a>
                        <form action="{{
                                path('app_route_service_items_public_service_delete',
                                {
                                    'id': route_service.id,
                                    publicService: publicServicesHash[node.properties.identifier].id,
                                    edgeId: node.properties.edgeParentId 
                                }) }}"
                            method="post"
                            class="inline ml-2"
                        >
                            <button type="submit" class="underline pr-2 text-red-600">{% trans %}delete{% endtrans %}</a>
                        </form>
                    </div>
                    {% if node.children is defined %}
                        <div>
                            {{ macros.menu_nodes(node.children, publicServicesHash, level + 1, route_service, parent) }}
                        </div>
                    {% endif %}
                {% endfor %}
            {% endmacro %}

            {% import _self as macros %}

            <ul class="main-menu">
            {% if nodes|length > 0 %}
                {{ macros.menu_nodes((nodes|first).children, publicServicesHash, 0, route_service, (nodes|first)) }}
            {% endif %}
            </ul>
        </div>
    </div>
{% endblock %}